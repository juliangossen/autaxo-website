---
import { getCollection } from "astro:content";

const normalizeSlug = (value, fallback) => {
  const raw = (typeof value === "string") ? value.trim() : "";
  const last = raw.split("/").filter(Boolean).pop();
  return (last && last.length > 0) ? last : fallback;
};

export async function getStaticPaths() {
  const entries = await getCollection("blog");

  const paths = entries
    .map((entry) => {
      const safeSlug = normalizeSlug(entry.data?.slug, entry.slug);
      if (!safeSlug) return null;

      return {
        params: { slug: safeSlug },
        props: { entry },
      };
    })
    .filter((x) => x !== null);

  return paths;
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<!-- Ab hier dein Layout/HTML fÃ¼r den Blogpost -->
<Content />
