---
// src/components/tools/TaxCheck25a.astro
---

<div class="bg-[#15171e] border border-white/10 rounded-2xl p-6 max-w-2xl mx-auto shadow-2xl my-12">
  <div class="text-center mb-8">
    <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-primary/20 text-primary mb-4 border border-primary/30">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
    </div>
    <h3 class="text-2xl font-bold text-white">§ 25a Quick-Check</h3>
    <p class="text-gray-400 mt-2 text-sm">Beantworte 3 Fragen und prüfe, ob du die Differenzbesteuerung anwenden darfst.</p>
  </div>

  <form id="tax-form" class="space-y-6">
    <div class="step" id="step-1">
      <p class="text-lg font-medium text-white mb-4">1. Von wem hast du das Fahrzeug gekauft?</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <button type="button" class="option-btn px-4 py-3 rounded-lg border border-white/20 hover:border-primary hover:bg-primary/10 text-left transition-all" data-value="privat" onclick="nextStep(1, 'privat')">
          <span class="block font-bold text-white">Privatperson</span>
          <span class="text-xs text-gray-400">Kein Unternehmer</span>
        </button>
        <button type="button" class="option-btn px-4 py-3 rounded-lg border border-white/20 hover:border-primary hover:bg-primary/10 text-left transition-all" data-value="business" onclick="nextStep(1, 'business')">
          <span class="block font-bold text-white">Unternehmer / Händler</span>
          <span class="text-xs text-gray-400">Firma, Selbstständiger, Autohaus</span>
        </button>
      </div>
    </div>

    <div class="step hidden" id="step-2">
      <p class="text-lg font-medium text-white mb-4">2. Wie wurde das Fahrzeug auf der Einkaufsrechnung ausgewiesen?</p>
      <div class="grid grid-cols-1 gap-3">
        <button type="button" class="option-btn px-4 py-3 rounded-lg border border-white/20 hover:border-primary hover:bg-primary/10 text-left transition-all" onclick="showResult('regel')">
          <span class="block font-bold text-white">Mit 19% MwSt. (Regelbesteuerung)</span>
          <span class="text-xs text-gray-400">Steuer offen ausgewiesen</span>
        </button>
        <button type="button" class="option-btn px-4 py-3 rounded-lg border border-white/20 hover:border-primary hover:bg-primary/10 text-left transition-all" onclick="showResult('25a')">
          <span class="block font-bold text-white">Differenzbesteuert (§25a Hinweis)</span>
          <span class="text-xs text-gray-400">Kein Steuerausweis, Hinweis auf Sonderregelung</span>
        </button>
        <button type="button" class="option-btn px-4 py-3 rounded-lg border border-white/20 hover:border-primary hover:bg-primary/10 text-left transition-all" onclick="showResult('klein')">
          <span class="block font-bold text-white">Kleinunternehmer (§ 19 UStG)</span>
          <span class="text-xs text-gray-400">Kein Steuerausweis</span>
        </button>
      </div>
      <button type="button" class="mt-4 text-sm text-gray-500 hover:text-white underline" onclick="resetForm()">← Zurück</button>
    </div>

    <div class="step hidden" id="result-box">
      <div id="result-content" class="p-4 rounded-xl mb-6"></div>
      
      <div class="bg-primary/10 border border-primary/20 rounded-lg p-4">
        <p class="text-sm text-gray-300 mb-3"><strong>Tipp:</strong> Autaxo erkennt diesen Steuerfall automatisch anhand deiner Eingaben und verhindert falsche Rechnungen.</p>
        <a href="https://garage.autaxo.de/auth/sign-up" class="block w-full text-center bg-primary hover:bg-primary-hover text-white font-bold py-2 rounded-lg transition-colors">
          Jetzt kostenlos testen
        </a>
      </div>
      <button type="button" class="mt-4 w-full text-sm text-gray-500 hover:text-white" onclick="resetForm()">Test neu starten</button>
    </div>
  </form>
</div>

<script>
  // Einfache Logik ohne Framework
  window.nextStep = (current, value) => {
    document.getElementById(`step-${current}`).classList.add('hidden');
    
    if (current === 1 && value === 'privat') {
      showResult('25a-privat');
    } else if (current === 1 && value === 'business') {
      document.getElementById('step-2').classList.remove('hidden');
    }
  };

  window.showResult = (type) => {
    // Verstecke alle Schritte
    document.querySelectorAll('.step').forEach(el => el.classList.add('hidden'));
    const resultBox = document.getElementById('result-box');
    const content = document.getElementById('result-content');
    resultBox.classList.remove('hidden');

    let html = '';
    let bgClass = '';

    if (type === '25a' || type === '25a-privat' || type === 'klein') {
      // ERFOLG: §25a möglich
      bgClass = 'bg-green-500/10 border-green-500/30';
      html = `
        <div class="text-green-400 font-bold text-xl mb-2 flex items-center gap-2">
          ✅ Differenzbesteuerung (§ 25a)
        </div>
        <p class="text-white">Du darfst (und solltest) hier die Differenzbesteuerung anwenden.</p>
        <ul class="mt-2 text-sm text-gray-300 list-disc list-inside">
          <li>Einkauf: Keine Vorsteuer ziehen!</li>
          <li>Verkauf: Steuer nur auf die Marge zahlen.</li>
          <li>Rechnung: Kein Steuerausweis, Hinweis auf §25a.</li>
        </ul>
      `;
    } else {
      // REGELBESTEUERUNG
      bgClass = 'bg-blue-500/10 border-blue-500/30';
      html = `
        <div class="text-blue-400 font-bold text-xl mb-2 flex items-center gap-2">
          ℹ️ Regelbesteuerung (19%)
        </div>
        <p class="text-white">Hier ist § 25a <strong>nicht</strong> zulässig.</p>
        <ul class="mt-2 text-sm text-gray-300 list-disc list-inside">
          <li>Einkauf: Du kannst die ausgewiesene Vorsteuer ziehen.</li>
          <li>Verkauf: Du musst 19% Steuer auf den vollen Verkaufspreis berechnen.</li>
        </ul>
      `;
    }

    content.className = `p-5 rounded-xl border ${bgClass}`;
    content.innerHTML = html;
  };

  window.resetForm = () => {
    document.querySelectorAll('.step').forEach(el => el.classList.add('hidden'));
    document.getElementById('step-1').classList.remove('hidden');
  };
</script>