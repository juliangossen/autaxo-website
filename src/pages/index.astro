---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { Icon } from 'astro-icon/components';

const title = "Autaxo | Dealer-Management-System für §25a, EU & Export";
const description =
  "Die Autohandel-Software mit KI. Digitale Fahrzeugakte, automatische Steuerlogik (§25a/EU/Export) und DATEV-Export. Jetzt kostenlos testen.";

const signupUrl = "https://garage.autaxo.de/auth/sign-up";
const demoUrl =
  "https://calendar.google.com/calendar/appointments/schedules/AcZssZ0-xc9C7ft1ZGEy3HpR6hP8NyrHXyM_ikIgv0KEUx9tSnzjZGoQ1RNyF4X5WMjk0o4vg6A9ksjD?gv=true&mode=week";

const modules = [
  {
    id: "mod-akte",
    nav: "Fahrzeugakte",
    title: "Digitale Fahrzeugakte",
    desc: "Alles am Fahrzeug: Status, Kosten, Dokumente, Nachweise – audit-ready.",
    bullets: [
      "Revisionssichere Ablage am Vorgang",
      "Klare Statuslogik statt Excel & Ordner",
    ],
    href: "/funktionen",
    icon: "lucide:folder-archive",
  },
  {
    id: "mod-vertraege",
    nav: "Dokumente",
    title: "Verträge & eSignatur",
    desc: "PDFs in Sekunden – strukturiert, konsistent, rechtssicher.",
    bullets: ["Kaufvertrag & Rechnung auf Knopfdruck", "Standardisiert + weniger Fehler"],
    href: "/funktionen/digitale-vertraege-esignatur",
    icon: "lucide:file-signature",
  },
  {
    id: "mod-steuer",
    nav: "Steuerlogik",
    title: "§25a / EU / Export Steuerlogik",
    desc: "Autaxo erkennt den Fall und setzt Hinweise + Pflichten automatisch.",
    bullets: ["Automatische Fall-Erkennung", "Dokumentations-Hinweise im Workflow"],
    href: "/funktionen/differenzbesteuerung-25a-ustg",
    icon: "lucide:scale",
  },
  {
    id: "mod-datev",
    nav: "DATEV",
    title: "Buchhaltung & DATEV",
    desc: "Export-ready Daten, weniger Rückfragen, schneller Monatsabschluss.",
    bullets: ["DATEV Export per Klick", "Struktur statt Nacharbeit"],
    href: "/funktionen/buchhaltung",
    icon: "lucide:calculator",
  },
  {
    id: "mod-carlo",
    nav: "Carlo",
    title: "KI-Assistent Carlo",
    desc: "Plausibilitätschecks & Leitplanken direkt im Prozess.",
    bullets: ["Typische Fehler früh erkennen", "Hilft bei Fragen zu Steuerfällen"],
    href: "/funktionen/ki-assistent",
    icon: "lucide:bot",
  },
];

const workflowSteps = [
  {
    id: "wf-1",
    n: 1,
    title: "FIN/Scan",
    desc: "Stammdaten automatisch.",
    modalTitle: "Scannen statt Tippen.",
    modalText:
      "Erfassen Sie ein Fahrzeug in unter 60 Sekunden. Einfach den Fahrzeugschein scannen – Autaxo liest die FIN automatisch aus, fragt die Stammdaten ab (Hersteller, Modell, EZ) und legt das Fahrzeug fehlerfrei an.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(1).mp4" },
  },
  {
    id: "wf-2",
    n: 2,
    title: "Kauf prüfen",
    desc: "VIES/USt-IdNr.",
    modalTitle: "Kauf korrekt erfassen.",
    modalText:
      "Egal ob von Privat oder Unternehmen – erfassen Sie den Verkäufer digital. Bei EU-Geschäften wird die USt-IdNr. automatisch geprüft.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(2).mp4" },
  },
  {
    id: "wf-3",
    n: 3,
    title: "Ankauf",
    desc: "Rechnung/Upload.",
    modalTitle: "Ankaufsrechnung.",
    modalText:
      "Erstellen Sie rechtssichere Ankaufsrechnungen (Gutschrift) oder laden Sie externe Belege einfach hoch. Alles digital.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(3).mp4" },
  },
  {
    id: "wf-4",
    n: 4,
    title: "Inserat",
    desc: "Schnell online.",
    modalTitle: "Schneller inserieren.",
    modalText:
      "Erstellen Sie mit einem Klick Verkaufsanzeigen auf bekannten Marktplätzen. Nach dem Verkauf wird das Inserat automatisch deaktiviert.",
    media: {
      type: "image",
      src: "https://storage.googleapis.com/autaxo-website/Homepage/Roadmap%20html%20block/Inserat%20Erstellen%20fu%CC%88r%20homepage%20(roadmap).png",
    },
  },
  {
    id: "wf-5",
    n: 5,
    title: "Vertrag",
    desc: "PDFs + Hinweise.",
    modalTitle: "Dokumente auf Knopfdruck.",
    modalText:
      "Erstellen Sie automatisch rechtssichere Kaufverträge und Rechnungen. Autaxo fügt die korrekten steuerlichen Hinweise automatisch hinzu.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(5).mp4" },
  },
  {
    id: "wf-6",
    n: 6,
    title: "Steuerfall",
    desc: "Auto-Erkennung.",
    modalTitle: "Steuerfälle? Erledigt.",
    modalText:
      "Autaxo erkennt automatisch: Differenzbesteuerung (§25a), Regelbesteuerung, innergemeinschaftliche Lieferung oder Export. Fehler werden minimiert.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(6).mp4" },
  },
  {
    id: "wf-7",
    n: 7,
    title: "Nachweise",
    desc: "Pflichten im Blick.",
    modalTitle: "Sicher für die Prüfung.",
    modalText:
      "Autaxo erinnert an Pflichten wie die Gelangensbestätigung bei steuerfreier igL und speichert diese direkt zum Vorgang ab.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(7).mp4" },
  },
  {
    id: "wf-8",
    n: 8,
    title: "DATEV",
    desc: "Export per Klick.",
    modalTitle: "Perfekt für den Steuerberater.",
    modalText:
      "Am Monatsende exportieren Sie alle Buchungssätze mit einem Klick im DATEV-Format (SKR03/04). Kein Sortieren von Belegen mehr notwendig.",
    media: { type: "video", src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website(8).mp4" },
  },
];
---

<MarketingLayout title={title} description={description}>
  <div class="relative overflow-hidden" data-page data-spotlight>
    <!-- Continuous background for the whole page -->
    <div class="pointer-events-none fixed inset-0 -z-10" aria-hidden="true">
      <div class="absolute inset-0 ax-mesh"></div>
      <div class="absolute inset-0 ax-grid-mask opacity-[0.55]"></div>
      <div class="absolute -top-48 -left-40 h-[640px] w-[640px] rounded-full bg-primary/18 blur-3xl ax-float"></div>
      <div class="absolute top-[55vh] -right-40 h-[720px] w-[720px] rounded-full bg-fuchsia-500/10 blur-3xl ax-float2"></div>
      <div class="absolute top-[130vh] -left-52 h-[760px] w-[760px] rounded-full bg-cyan-400/8 blur-3xl ax-float3"></div>
      <div class="absolute inset-0 ax-spotlight"></div>
    </div>

    <!-- HERO -->
    <section class="pt-28 pb-12 lg:pt-44 lg:pb-14">
      <div class="container mx-auto px-4">
        <div class="grid lg:grid-cols-12 gap-10 lg:gap-12 items-center">
          <div class="lg:col-span-6">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-white/90 text-xs font-semibold tracking-wide">
              <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
              </span>
              Live: KI-Assistent <span class="text-primary">Carlo</span>
            </div>

            <h1 class="mt-6 text-5xl lg:text-7xl font-extrabold tracking-tight text-white leading-[1.02] text-balance">
              Autohandel.{" "}
              <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-red-400 to-fuchsia-400">
                Automatisiert.
              </span>
            </h1>

            <p class="mt-6 text-lg lg:text-xl text-text-muted leading-relaxed max-w-xl text-balance">
              Von der FIN zum Vertrag in 60 Sekunden. Steuerlogik (§25a/EU/Export), Dokumente und DATEV-Export – in einem Flow.
            </p>

            <div class="mt-8 flex flex-col sm:flex-row gap-4">
              <a
                href={signupUrl}
                class="group w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/25"
              >
                Kostenlos testen
                <Icon name="lucide:arrow-right" class="w-5 h-5 transition-transform group-hover:translate-x-0.5" />
              </a>

              <a
                href={demoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="group w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
              >
                <Icon name="lucide:calendar" class="w-5 h-5 text-primary" />
                Demo buchen
              </a>
            </div>

            <div class="mt-8 grid grid-cols-3 gap-3 max-w-lg" data-reveal>
              <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-4">
                <p class="text-white text-xl font-extrabold">60s</p>
                <p class="text-xs text-white/60 mt-1">FIN → Vertrag</p>
              </div>
              <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-4">
                <p class="text-white text-xl font-extrabold">§25a</p>
                <p class="text-xs text-white/60 mt-1">EU & Export</p>
              </div>
              <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-4">
                <p class="text-white text-xl font-extrabold">DATEV</p>
                <p class="text-xs text-white/60 mt-1">per Klick</p>
              </div>
            </div>
          </div>

          <!-- Right: product window -->
          <div class="lg:col-span-6" data-reveal>
            <div class="relative">
              <div class="absolute -inset-1 rounded-3xl bg-gradient-to-r from-primary/35 via-fuchsia-500/20 to-cyan-400/20 blur-xl opacity-70"></div>

              <div class="relative rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl overflow-hidden shadow-2xl">
                <div class="flex items-center justify-between px-5 py-4 border-b border-white/10 bg-white/5">
                  <div class="flex items-center gap-2">
                    <span class="h-2.5 w-2.5 rounded-full bg-red-500/70"></span>
                    <span class="h-2.5 w-2.5 rounded-full bg-yellow-500/70"></span>
                    <span class="h-2.5 w-2.5 rounded-full bg-green-500/70"></span>
                  </div>
                  <div class="text-xs font-mono text-white/45">SSG • Edge</div>
                </div>

                <div class="p-5 lg:p-6">
                  <div class="grid sm:grid-cols-2 gap-4">
                    <div class="relative rounded-2xl border border-white/10 bg-white/5 overflow-hidden">
                      <div class="absolute inset-0 ax-shine opacity-60" aria-hidden="true"></div>
                      <img
                        src="/screenshots/dark-mode.webp"
                        alt="Autaxo Dashboard (Dark Mode)"
                        class="w-full h-[260px] sm:h-full object-cover object-top"
                        loading="eager"
                        decoding="async"
                      />
                      <div class="absolute bottom-3 left-3 right-3 flex items-center justify-between">
                        <span class="text-[11px] text-white/70 bg-black/40 border border-white/10 px-2.5 py-1 rounded-full">
                          Dashboard
                        </span>
                        <span class="text-[11px] text-white/70 bg-black/40 border border-white/10 px-2.5 py-1 rounded-full">
                          Audit-ready
                        </span>
                      </div>
                    </div>

                    <div class="relative rounded-2xl border border-white/10 bg-white/5 overflow-hidden">
                      <div class="absolute inset-0 ax-scanline" aria-hidden="true"></div>
                      <div class="p-4">
                        <div class="flex items-center gap-2">
                          <div class="h-9 w-9 rounded-full bg-primary/20 border border-primary/30 flex items-center justify-center">
                            <Icon name="lucide:bot" class="w-4 h-4 text-primary" />
                          </div>
                          <div>
                            <p class="text-sm font-bold text-white leading-tight">Carlo</p>
                            <p class="text-xs text-white/50">Checks im Workflow</p>
                          </div>
                        </div>

                        <div class="mt-4 text-sm space-y-3">
                          <div class="rounded-2xl bg-[#15171e] border border-white/10 px-3 py-2 text-text-muted">
                            „Italien netto – was beachten?“
                          </div>
                          <div class="rounded-2xl bg-primary/10 border border-primary/20 px-3 py-2 text-white">
                            „igE erkannt. VIES prüfen, Erwerbsteuer abführen/ziehen.“
                          </div>
                        </div>

                        <a href="/funktionen/ki-assistent" class="mt-4 inline-flex items-center gap-2 text-xs font-semibold text-white/80 hover:text-white">
                          Mehr zu Carlo <Icon name="lucide:arrow-right" class="w-4 h-4 text-primary" />
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="mt-4 flex flex-wrap gap-2">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/5 border border-white/10 text-white/70">Fahrzeugakte</span>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/5 border border-white/10 text-white/70">§25a/EU/Export</span>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/5 border border-white/10 text-white/70">DATEV</span>
                  </div>
                </div>
              </div>

              <div class="mt-4 ax-divider" aria-hidden="true"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MODULE NAV + SCROLLSPY (overview + auto active) -->
    <section class="pb-24">
      <div class="container mx-auto px-4">
        <div class="grid lg:grid-cols-12 gap-10 lg:gap-12">
          <!-- Sticky Navigator -->
          <div class="lg:col-span-4">
            <div class="lg:sticky lg:top-28">
              <div class="inline-flex items-center gap-2 text-primary font-bold tracking-wider uppercase text-sm" data-reveal>
                <Icon name="lucide:layers" class="w-4 h-4" />
                Überblick
              </div>

              <h2 class="mt-3 text-3xl lg:text-4xl font-extrabold text-white text-balance" data-reveal>
                Ein System. <span class="text-primary">Ein Flow.</span>
              </h2>

              <p class="mt-4 text-text-muted" data-reveal>
                Scrollen Sie durch die Module – links wird automatisch das aktive Modul markiert.
              </p>

              <nav class="mt-6 grid gap-2" aria-label="Module Navigator" data-reveal>
                {modules.map((m) => (
                  <a
                    href={`#${m.id}`}
                    data-mod-link={m.id}
                    class="ax-nav-item rounded-2xl border border-white/10 bg-white/5 px-4 py-3 flex items-center gap-3 hover:border-primary/40 transition-colors"
                  >
                    <div class="h-9 w-9 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary">
                      <Icon name={m.icon} class="w-5 h-5" />
                    </div>
                    <div class="flex-1">
                      <p class="text-white font-bold leading-tight">{m.nav}</p>
                      <p class="text-xs text-white/50 mt-0.5">{m.title}</p>
                    </div>
                    <Icon name="lucide:chevron-right" class="w-4 h-4 text-white/40" />
                  </a>
                ))}
              </nav>

              <div class="mt-8 flex flex-col sm:flex-row gap-3" data-reveal>
                <a
                  href={signupUrl}
                  class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-7 py-3.5 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/20"
                >
                  Kostenlos testen
                  <Icon name="lucide:arrow-right" class="w-5 h-5" />
                </a>
                <a
                  href="/preise"
                  class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-7 py-3.5 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
                >
                  Preise
                </a>
              </div>
            </div>
          </div>

          <!-- Module Story (scroll target sections) -->
          <div class="lg:col-span-8">
            <div class="grid gap-6">
              {modules.map((m) => (
                <section
                  id={m.id}
                  data-mod-section={m.id}
                  class="rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl p-7 shadow-2xl"
                  data-reveal
                >
                  <div class="flex items-start gap-4">
                    <div class="h-12 w-12 rounded-2xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary">
                      <Icon name={m.icon} class="w-6 h-6" />
                    </div>
                    <div class="flex-1">
                      <h3 class="text-white font-extrabold text-xl">{m.title}</h3>
                      <p class="mt-2 text-text-muted">{m.desc}</p>

                      <ul class="mt-4 grid sm:grid-cols-2 gap-3 text-sm">
                        {m.bullets.map((b) => (
                          <li class="flex items-start gap-2 text-white/75">
                            <Icon name="lucide:check" class="w-4 h-4 text-primary mt-0.5" />
                            <span>{b}</span>
                          </li>
                        ))}
                      </ul>

                      <a href={m.href} class="mt-5 inline-flex items-center gap-2 text-sm font-semibold text-white/80 hover:text-white">
                        Details öffnen <Icon name="lucide:arrow-right" class="w-4 h-4 text-primary" />
                      </a>
                    </div>
                  </div>
                </section>
              ))}
            </div>

            <div class="mt-10 ax-divider" aria-hidden="true"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORKFLOW DEMOS (compact overview grid) -->
    <section id="workflow" class="pb-24">
      <div class="container mx-auto px-4">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-8 lg:p-10" data-reveal>
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
            <div>
              <span class="text-primary font-bold tracking-wider uppercase text-sm block">Workflow</span>
              <h2 class="mt-2 text-3xl lg:text-4xl font-extrabold text-white text-balance">
                8 Schritte. Ein Prozess.
              </h2>
              <p class="mt-3 text-text-muted">
                Kacheln anklicken → Demo öffnet sich. Videos laden erst beim Öffnen.
              </p>
            </div>

            <a
              href={signupUrl}
              class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/20"
            >
              Starten
              <Icon name="lucide:arrow-right" class="w-5 h-5" />
            </a>
          </div>

          <div class="mt-8 grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {workflowSteps.map((s) => (
              <button
                type="button"
                data-open-modal={s.id}
                class="group text-left rounded-2xl border border-white/10 bg-[#0b0c10]/60 hover:border-primary/40 transition-colors p-4"
              >
                <div class="flex items-center justify-between">
                  <span class="h-8 w-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white/70 font-bold text-xs">
                    {s.n}
                  </span>
                  <Icon name="lucide:play" class="w-4 h-4 text-white/40 group-hover:text-primary transition-colors" />
                </div>
                <p class="mt-3 text-white font-bold">{s.title}</p>
                <p class="mt-1 text-xs text-white/60">{s.desc}</p>
              </button>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- FINAL CTA -->
    <section class="pb-28">
      <div class="container mx-auto px-4 max-w-5xl">
        <div class="rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl p-10 lg:p-14 text-center relative overflow-hidden" data-reveal>
          <div class="absolute -top-32 left-1/2 -translate-x-1/2 h-[420px] w-[420px] rounded-full bg-primary/20 blur-3xl" aria-hidden="true"></div>
          <h2 class="text-3xl lg:text-5xl font-extrabold text-white text-balance">
            Kostenlos testen. In 2 Minuten produktiv.
          </h2>
          <p class="mt-5 text-lg text-text-muted max-w-2xl mx-auto">
            Keine Kreditkarte erforderlich. Jederzeit kündbar.
          </p>
          <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
            <a
              href={signupUrl}
              class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/20"
            >
              Kostenlos starten
              <Icon name="lucide:arrow-right" class="w-5 h-5" />
            </a>
            <a
              href={demoUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
            >
              Demo buchen
            </a>
          </div>
        </div>
      </div>
    </section>

    {/* MODALS */}
    {workflowSteps.map((s) => (
      <dialog
        id={s.id}
        class="bg-transparent p-0 w-full max-w-7xl backdrop:bg-black/80 backdrop:backdrop-blur-sm rounded-2xl shadow-2xl border border-white/10 m-auto"
      >
        <div class="bg-[#15171e] rounded-2xl overflow-hidden relative">
          <button
            type="button"
            data-close-modal
            class="absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-primary text-white rounded-full transition-colors"
            aria-label="Dialog schließen"
          >
            <Icon name="lucide:x" class="w-6 h-6" />
          </button>

          <div class="grid lg:grid-cols-5 h-full">
            <div class="lg:col-span-3 bg-black flex items-center justify-center aspect-video lg:aspect-auto h-[40vh] lg:h-[70vh]">
              {s.media.type === "video" ? (
                <video
                  controls
                  preload="none"
                  class="w-full h-full object-contain"
                  data-video
                  data-src={s.media.src}
                />
              ) : (
                <img
                  src={s.media.src}
                  alt={`Workflow Demo: ${s.title}`}
                  class="w-full h-full object-contain"
                  loading="lazy"
                  decoding="async"
                />
              )}
            </div>

            <div class="lg:col-span-2 p-8 lg:p-12 flex flex-col justify-center bg-[#15171e]">
              <h3 class="text-2xl lg:text-3xl font-bold text-white mb-6">{s.modalTitle}</h3>
              <p class="text-text-muted text-lg leading-relaxed mb-8">{s.modalText}</p>

              <button
                type="button"
                data-close-modal
                class="self-start px-8 py-3 border border-white/20 hover:bg-white/10 text-white rounded-lg transition-colors"
              >
                Schließen
              </button>
            </div>
          </div>
        </div>
      </dialog>
    ))}
  </div>
</MarketingLayout>

<style>
  /* Canvas background */
  .ax-mesh{
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(179,0,24,.18), transparent 55%),
      radial-gradient(900px 520px at 15% 20%, rgba(99,102,241,.18), transparent 60%),
      radial-gradient(700px 500px at 85% 70%, rgba(34,211,238,.12), transparent 60%),
      linear-gradient(180deg, rgba(11,12,16,1) 0%, rgba(11,12,16,1) 40%, rgba(11,12,16,1) 100%);
  }
  .ax-grid-mask{
    background-image:
      linear-gradient(to right, rgba(255,255,255,.07) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.07) 1px, transparent 1px);
    background-size: 48px 48px;
    mask-image: radial-gradient(70% 60% at 50% 25%, #000 0%, transparent 68%);
  }
  .ax-spotlight{
    background: radial-gradient(650px 420px at var(--mx, 50%) var(--my, 30%), rgba(255,255,255,.10), transparent 60%);
    transition: background-position 80ms linear;
  }
  .ax-divider{
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
  }

  /* Floating glows */
  @keyframes axFloat { 0%,100%{ transform:translate3d(0,0,0)} 50%{ transform:translate3d(0,-18px,0)} }
  @keyframes axFloat2 { 0%,100%{ transform:translate3d(0,0,0)} 50%{ transform:translate3d(0,14px,0)} }
  @keyframes axFloat3 { 0%,100%{ transform:translate3d(0,0,0)} 50%{ transform:translate3d(0,-10px,0)} }
  .ax-float{ animation: axFloat 9s ease-in-out infinite; }
  .ax-float2{ animation: axFloat2 11s ease-in-out infinite; }
  .ax-float3{ animation: axFloat3 12.5s ease-in-out infinite; }

  /* Shine + scanline */
  @keyframes axShine { 0%{ transform:translateX(-120%) } 100%{ transform:translateX(120%) } }
  .ax-shine{
    background: linear-gradient(110deg, transparent 0%, rgba(255,255,255,.10) 45%, transparent 60%);
    transform: translateX(-120%);
    animation: axShine 5.2s ease-in-out infinite;
  }
  @keyframes axScan { 0%{ transform:translateY(-30%)} 100%{ transform:translateY(130%)} }
  .ax-scanline{
    background: linear-gradient(180deg, transparent, rgba(179,0,24,.22), transparent);
    height: 26%;
    width: 100%;
    transform: translateY(-30%);
    animation: axScan 4.8s ease-in-out infinite;
    opacity: .35;
  }

  /* Reveal */
  .js [data-reveal]{
    opacity: 0;
    transform: translateY(14px);
    transition: opacity .6s ease, transform .7s ease;
  }
  .js [data-reveal].is-visible{
    opacity: 1;
    transform: translateY(0);
  }

  /* ScrollSpy nav active */
  .ax-nav-item.is-active{
    border-color: rgba(179,0,24,.55);
    background: rgba(179,0,24,.08);
  }
  .ax-nav-item.is-active p:first-child{
    color: rgba(255,255,255,1);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    .ax-float, .ax-float2, .ax-float3, .ax-shine, .ax-scanline{ animation: none !important; }
    .js [data-reveal]{ opacity: 1 !important; transform: none !important; }
  }
</style>

<script is:inline>
  document.documentElement.classList.add('js');

  // Spotlight (rAF throttled)
  const page = document.querySelector('[data-spotlight]');
  let mx = 50, my = 30, raf = 0;
  function commitSpot() {
    raf = 0;
    if (!page) return;
    page.style.setProperty('--mx', mx + '%');
    page.style.setProperty('--my', my + '%');
  }
  if (page) {
    page.addEventListener('pointermove', (ev) => {
      const r = page.getBoundingClientRect();
      mx = ((ev.clientX - r.left) / r.width) * 100;
      my = ((ev.clientY - r.top) / r.height) * 100;
      if (!raf) raf = requestAnimationFrame(commitSpot);
    }, { passive: true });
  }

  // Reveal-on-scroll
  const revealEls = Array.from(document.querySelectorAll('[data-reveal]'));
  const io = new IntersectionObserver((entries) => {
    for (const e of entries) {
      if (e.isIntersecting) {
        e.target.classList.add('is-visible');
        io.unobserve(e.target);
      }
    }
  }, { threshold: 0.14 });
  revealEls.forEach((el) => io.observe(el));

  // Module ScrollSpy (auto active)
  const navItems = Array.from(document.querySelectorAll('[data-mod-link]'));
  const sections = Array.from(document.querySelectorAll('[data-mod-section]'));

  function setActive(id) {
    navItems.forEach((a) => {
      const isActive = a.getAttribute('data-mod-link') === id;
      a.classList.toggle('is-active', isActive);
      if (isActive) a.setAttribute('aria-current', 'true');
      else a.removeAttribute('aria-current');
    });
  }

  // Default active = first
  if (sections[0]) setActive(sections[0].getAttribute('data-mod-section'));

  const spy = new IntersectionObserver((entries) => {
    // pick most visible intersecting section
    const visible = entries
      .filter((e) => e.isIntersecting)
      .sort((a, b) => (b.intersectionRatio || 0) - (a.intersectionRatio || 0))[0];

    if (visible?.target) {
      const id = visible.target.getAttribute('data-mod-section');
      if (id) setActive(id);
    }
  }, {
    // keep the “active” region around the middle of viewport
    rootMargin: "-35% 0px -55% 0px",
    threshold: [0.12, 0.2, 0.35, 0.5, 0.7],
  });

  sections.forEach((s) => spy.observe(s));

  // Modals + lazy video attach
  const openButtons = document.querySelectorAll('[data-open-modal]');
  const closeButtons = document.querySelectorAll('[data-close-modal]');

  function attachVideoSource(dialog) {
    const video = dialog.querySelector('video[data-video]');
    if (!video) return;
    if (video.dataset.loaded === '1') return;
    const src = video.getAttribute('data-src');
    if (!src) return;

    const source = document.createElement('source');
    source.src = src;
    source.type = 'video/mp4';
    video.appendChild(source);
    video.dataset.loaded = '1';
  }

  function playVideo(dialog) {
    const video = dialog.querySelector('video[data-video]');
    if (!video) return;
    try { video.play(); } catch (_) {}
  }

  function pauseVideo(dialog) {
    const video = dialog.querySelector('video[data-video]');
    if (!video) return;
    try { video.pause(); video.currentTime = 0; } catch (_) {}
  }

  function openModalById(id) {
    const dialog = document.getElementById(id);
    if (!dialog) return;
    dialog.showModal();
    attachVideoSource(dialog);
    playVideo(dialog);
  }

  function closeModal(dialog) {
    if (!dialog) return;
    pauseVideo(dialog);
    dialog.close();
  }

  openButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-open-modal');
      if (id) openModalById(id);
    });
  });

  closeButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const dialog = btn.closest('dialog');
      closeModal(dialog);
    });
  });

  document.querySelectorAll('dialog').forEach((dialog) => {
    dialog.addEventListener('click', (e) => {
      if (e.target === dialog) closeModal(dialog);
    });
    dialog.addEventListener('close', () => pauseVideo(dialog));
  });
</script>
