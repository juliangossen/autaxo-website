---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { Icon } from 'astro-icon/components';

const title = "Autaxo Blog: §25a, DATEV, GoBD & EU/Export im Gebrauchtwagenhandel";
const description =
  "Praxiswissen für Gebrauchtwagenhändler in Deutschland: Differenzbesteuerung (§25a UStG), EU/Export-Nachweise, GoBD-Dokumentation, DATEV-Export und Prozesse – kompakt erklärt.";

/** Robust canonical */
const canonicalUrl = (() => {
  try {
    if (Astro.site) return new URL(Astro.url.pathname, Astro.site).toString();
  } catch (_) {}
  return "https://www.autaxo.de/blog/";
})();
const pageUrl = canonicalUrl.endsWith("/") ? canonicalUrl : `${canonicalUrl}/`;

/**
 * Posts (manuell pflegbar)
 * Empfehlung: später per Astro Content Collections automatisieren.
 */
const posts = [
  {
    slug: "/blog/reverse-charge-im-kfz-handel-meist-nicht-ss13b-innergemeinschaftliche-lieferung-gelangensbestatigung/",
    title:
      "Reverse-Charge im Kfz-Handel? (Meist nicht §13b) – Innergemeinschaftliche Lieferung & Gelangensbestätigung",
    excerpt:
      "Wann Reverse-Charge wirklich greift – und welche Nachweise du für EU-Fälle sauber führen musst (Gelangensbestätigung, Belege, Plausibilität).",
    date: "2025-12-22",
    image: null,
    tags: ["EU", "Export", "USt", "Nachweise"],
  },
  {
    slug: "/blog/steuertipps/",
    title: "Differenzbesteuerung § 25a im Kfz-Handel – mit Beispiel & Checkliste",
    excerpt:
      "Praxisnah erklärt: Voraussetzungen, typische Fehler und eine Checkliste für §25a UStG im Händleralltag.",
    date: "2025-09-02",
    image: "https://unicorn-images.b-cdn.net/faab84a4-aa04-4bc6-832b-23346c1792a7?optimizer=gif",
    tags: ["§25a", "Differenzbesteuerung", "USt"],
  },
  {
    slug: "/blog/vin-zu-vertrag/",
    title: "Einkauf & Verkauf: FIN scan statt manuell – so beschleunigst du Einkauf & Verkauf",
    excerpt:
      "Von FIN/Scan bis Vertrag: weniger Tipparbeit, weniger Fehler, schnellere Abläufe im Gebrauchtwagenhandel.",
    date: "2025-09-02",
    image: "https://unicorn-images.b-cdn.net/55e5cbf8-3ee6-4ed0-9bb1-373a4ebe5241?optimizer=gif",
    tags: ["Workflow", "FIN", "Prozess"],
  },
  {
    slug: "/blog/buchhaltung-datev/",
    title: "Buchhaltung & DATEV – DATEV-Export im Autohaus: SKR04-Buchungsstapel ohne Nacharbeit",
    excerpt:
      "So erwartet es das Steuerbüro: vollständige Belege, konsistente Daten und ein sauberer DATEV-Export (SKR03/04).",
    date: "2025-09-02",
    image: "https://unicorn-images.b-cdn.net/4aa56595-7aed-4afc-a812-0ea080c65d90?optimizer=gif",
    tags: ["DATEV", "Buchhaltung", "GoBD"],
  },
];

const fallbackImage = "/og/autaxo-og.png";

// Sort newest first (sicher)
const sortedPosts = [...posts].sort((a, b) => (a.date < b.date ? 1 : -1));

// Themen (für Filter/LLM-Signale)
const topics = [
  { label: "§25a", key: "§25a" },
  { label: "DATEV", key: "datev" },
  { label: "GoBD", key: "gobd" },
  { label: "EU/Export", key: "export" },
  { label: "Nachweise", key: "nachweise" },
  { label: "Workflow", key: "workflow" },
];

// Structured data
const schema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "BreadcrumbList",
      "@id": `${pageUrl}#breadcrumb`,
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://www.autaxo.de/" },
        { "@type": "ListItem", "position": 2, "name": "Blog", "item": pageUrl }
      ]
    },
    {
      "@type": "Blog",
      "@id": `${pageUrl}#blog`,
      "name": title,
      "description": description,
      "url": pageUrl
    },
    {
      "@type": "ItemList",
      "@id": `${pageUrl}#posts`,
      "itemListOrder": "https://schema.org/ItemListOrderDescending",
      "numberOfItems": sortedPosts.length,
      "itemListElement": sortedPosts.map((p, i) => ({
        "@type": "ListItem",
        "position": i + 1,
        "url": `https://www.autaxo.de${p.slug}`,
        "item": {
          "@type": "BlogPosting",
          "headline": p.title,
          "description": p.excerpt,
          "datePublished": p.date,
          "image": p.image || `https://www.autaxo.de${fallbackImage}`,
          "mainEntityOfPage": `https://www.autaxo.de${p.slug}`
        }
      }))
    }
  ]
};
---

<MarketingLayout title={title} description={description} canonicalUrl={canonicalUrl} image={fallbackImage}>
  <script type="application/ld+json" slot="head" set:html={JSON.stringify(schema)} />

  {/* HERO */}
  <section class="relative pt-32 pb-14 bg-[#0b0c10] overflow-hidden">
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[900px] h-[520px] bg-primary/10 blur-[140px] rounded-full pointer-events-none -z-10"></div>

    <div class="container mx-auto px-4 max-w-5xl text-center relative">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-primary text-sm font-medium mb-6">
        <Icon name="lucide:book-open" class="w-4 h-4" />
        Autaxo Blog
      </div>

      <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-5 tracking-tight leading-tight">
        Praxiswissen zu <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-red-400">§25a, DATEV, GoBD</span><br class="hidden md:block" />
        und EU/Export im Gebrauchtwagenhandel
      </h1>

      <p class="text-lg md:text-xl text-white/70 leading-relaxed max-w-4xl mx-auto">
        Für Gebrauchtwagenhändler in Deutschland: Steuerthemen (UStG), Nachweise (EU/Export), GoBD-Dokumentation und
        Buchhaltungsprozesse – verständlich und praxisnah.
      </p>

      {/* Suchfeld */}
      <div class="mt-9 max-w-2xl mx-auto">
        <div class="relative">
          <Icon name="lucide:search" class="w-5 h-5 text-white/40 absolute left-4 top-1/2 -translate-y-1/2" />
          <input
            id="blog-search"
            type="text"
            placeholder="Artikel durchsuchen (z. B. §25a, DATEV, Export, GoBD)…"
            class="w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-white/40 focus:outline-none focus:border-primary/50"
          />
        </div>
      </div>

      {/* Themen-Chips (Filter + SEO/LLM Signale im sichtbaren Text) */}
      <div class="mt-6 flex flex-wrap gap-2 justify-center" aria-label="Themen">
        <button
          type="button"
          class="ax-topic-chip is-active inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white/80 hover:text-white hover:border-primary/40 transition-colors text-sm"
          data-topic="all"
        >
          <Icon name="lucide:layers" class="w-4 h-4 text-primary" />
          Alle Themen
        </button>

        {topics.map((t) => (
          <button
            type="button"
            class="ax-topic-chip inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white/80 hover:text-white hover:border-primary/40 transition-colors text-sm"
            data-topic={t.key.toLowerCase()}
          >
            <Icon name="lucide:tag" class="w-4 h-4 text-white/40" />
            {t.label}
          </button>
        ))}
      </div>

      {/* LLM/SEO: Kurz erklärt, was der Blog abdeckt (klarer Text, keine Floskeln) */}
      <div class="mt-10 max-w-4xl mx-auto text-left rounded-2xl border border-white/10 bg-[#15171e] p-6">
        <div class="flex items-center gap-2 mb-3">
          <Icon name="lucide:info" class="w-5 h-5 text-primary" />
          <h2 class="text-white font-bold text-lg m-0">Was du hier findest</h2>
        </div>
        <ul class="list-disc pl-5 text-white/70 space-y-2">
          <li><strong>Umsatzsteuer im Autohandel:</strong> §25a Differenzbesteuerung, Regelbesteuerung, Sonderfälle.</li>
          <li><strong>EU/Export:</strong> Nachweise, Gelangensbestätigung, typische Prüfungsfallen.</li>
          <li><strong>GoBD:</strong> Dokumentation, Belegführung, nachvollziehbare Prozesse für Betriebsprüfungen.</li>
          <li><strong>DATEV:</strong> Export-Logik, saubere Datenübergabe, weniger Rückfragen aus der Kanzlei.</li>
        </ul>

        <div class="mt-4 text-sm text-white/70">
          Passende Produktseiten:{" "}
          <a class="underline hover:text-white" href="/funktionen/differenzbesteuerung-25a-ustg">§25a</a>{" "}
          ·{" "}
          <a class="underline hover:text-white" href="/funktionen/buchhaltung">Buchhaltung/DATEV</a>{" "}
          ·{" "}
          <a class="underline hover:text-white" href="/downloads">Downloads & Vorlagen</a>
        </div>
      </div>
    </div>
  </section>

  {/* LISTE (Beitrag unter Beitrag) */}
  <main class="pb-24 bg-[#0b0c10]">
    <div class="container mx-auto px-4 max-w-5xl">
      <ol class="space-y-4" id="blog-list" aria-label="Blogartikel">
        {sortedPosts.map((post) => (
          <li data-post-row data-title={post.title.toLowerCase()} data-tags={(post.tags || []).join(" ").toLowerCase()}>
            <article class="group rounded-2xl border border-white/10 bg-[#15171e] hover:border-primary/50 transition-all overflow-hidden">
              <a href={post.slug} class="block">
                <div class="grid md:grid-cols-12 gap-0 md:gap-6">
                  {/* Thumbnail */}
                  <div class="md:col-span-4 bg-black/30">
                    <img
                      src={post.image || fallbackImage}
                      alt={post.title}
                      loading="lazy"
                      decoding="async"
                      class="w-full h-full object-cover aspect-[16/9] md:aspect-auto md:min-h-[170px] opacity-90 group-hover:opacity-100 transition-opacity"
                    />
                  </div>

                  {/* Content */}
                  <div class="md:col-span-8 p-6 md:py-7 md:pr-7 md:pl-0">
                    <div class="flex flex-wrap items-center gap-2 text-xs mb-3">
                      <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-white/5 border border-white/10 text-white/70">
                        <Icon name="lucide:calendar" class="w-3.5 h-3.5 text-white/40" />
                        {new Date(post.date).toLocaleDateString("de-DE", { year: "numeric", month: "long", day: "2-digit" })}
                      </span>

                      {(post.tags || []).slice(0, 3).map((t) => (
                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-white/5 border border-white/10 text-white/70">
                          <Icon name="lucide:tag" class="w-3.5 h-3.5 text-white/40" />
                          {t}
                        </span>
                      ))}
                    </div>

                    <h3 class="text-xl md:text-2xl font-extrabold text-white leading-snug group-hover:text-primary transition-colors">
                      {post.title}
                    </h3>

                    <p class="mt-3 text-text-muted leading-relaxed">
                      {post.excerpt}
                    </p>

                    <div class="mt-4 inline-flex items-center gap-2 text-primary font-bold">
                      Weiterlesen
                      <Icon name="lucide:arrow-right" class="w-4 h-4 transition-transform group-hover:translate-x-0.5" />
                    </div>
                  </div>
                </div>
              </a>
            </article>
          </li>
        ))}
      </ol>

      {/* CTA */}
      <section class="mt-16 bg-gradient-to-br from-[#1a1d26] to-[#15171e] border border-white/10 rounded-2xl p-8 md:p-12 text-center relative overflow-hidden">
        <div class="absolute top-0 right-0 w-72 h-72 bg-primary/10 blur-[90px] rounded-full pointer-events-none"></div>

        <div class="relative z-10 max-w-3xl mx-auto">
          <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">
            Autaxo: Prozesse, Nachweise und Steuerlogik in einem Workflow
          </h2>
          <p class="text-white/70 text-lg mb-8">
            Digitale Fahrzeugakte, Dokumente, §25a/EU/Export-Logik und DATEV-Export – aufgebaut für den Händleralltag in Deutschland.
          </p>

          <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <a
              href="https://garage.autaxo.de/auth/sign-up"
              class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-primary text-white font-bold rounded-xl hover:bg-primary-hover transition-all shadow-lg shadow-primary/25"
            >
              Kostenlos testen
              <Icon name="lucide:arrow-right" class="w-5 h-5" />
            </a>
            <a
              href="/funktionen"
              class="inline-flex items-center justify-center gap-2 px-8 py-4 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
            >
              Funktionen ansehen
            </a>
          </div>

          <p class="mt-4 text-xs text-white/50">30 Tage kostenlos. Keine Kreditkarte erforderlich.</p>
        </div>
      </section>
    </div>
  </main>

  {/* Filter + Suche (client-side) */}
  <script is:inline>
    const search = document.getElementById('blog-search');
    const rows = Array.from(document.querySelectorAll('[data-post-row]'));
    const chips = Array.from(document.querySelectorAll('.ax-topic-chip'));

    let activeTopic = 'all';

    function normalize(s){ return (s || '').toLowerCase().trim(); }

    function setActiveChip(key){
      chips.forEach((c) => {
        const k = c.getAttribute('data-topic');
        c.classList.toggle('is-active', k === key);
        c.classList.toggle('border-primary/50', k === key);
      });
    }

    function matchesTopic(hay, topic){
      if(topic === 'all') return true;
      return hay.includes(topic);
    }

    function apply(){
      const q = normalize(search?.value);
      rows.forEach((r) => {
        const title = r.getAttribute('data-title') || '';
        const tags  = r.getAttribute('data-tags') || '';
        const hay = (title + ' ' + tags);
        const show = (!q || hay.includes(q)) && matchesTopic(hay, activeTopic);
        r.style.display = show ? '' : 'none';
      });
    }

    chips.forEach((c) => {
      c.addEventListener('click', () => {
        activeTopic = (c.getAttribute('data-topic') || 'all');
        setActiveChip(activeTopic);
        apply();
      });
    });

    search?.addEventListener('input', apply);

    // init
    setActiveChip('all');
  </script>

  <style>
    .ax-topic-chip.is-active{
      color: rgba(255,255,255,1);
      border-color: rgba(179,0,24,.55) !important;
      background: rgba(179,0,24,.08) !important;
    }
  </style>
</MarketingLayout>
