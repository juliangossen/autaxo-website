---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { Icon } from 'astro-icon/components';

const title = "Autaxo | Dealer-Management-System für §25a, EU & Export";
const description =
  "Die Autohandel-Software mit KI: Digitale Fahrzeugakte, automatische Steuerlogik (§25a/EU/Export), Dokumente und DATEV-Export. Kostenlos testen.";

const signupUrl = "https://garage.autaxo.de/auth/sign-up";
const demoUrl =
  "https://calendar.google.com/calendar/appointments/schedules/AcZssZ0-xc9C7ft1ZGEy3HpR6hP8NyrHXyM_ikIgv0KEUx9tSnzjZGoQ1RNyF4X5WMjk0o4vg6A9ksjD?gv=true&mode=week";

/** Robust canonical (nutzt Astro.site, fällt sonst auf autaxo.de zurück) */
const canonicalUrl = (() => {
  try {
    if (Astro.site) return new URL(Astro.url.pathname, Astro.site).toString();
  } catch (_) {}
  return "https://autaxo.de/";
})();
const pageUrl = canonicalUrl.endsWith("/") ? canonicalUrl : `${canonicalUrl}/`;

const modules = [
  {
    id: "mod-akte",
    nav: "Fahrzeugakte",
    title: "Digitale Fahrzeugakte",
    desc: "Status, Kosten, Dokumente und Nachweise zentral am Vorgang – audit-ready.",
    bullets: [
      "Revisionssichere Ablage am Vorgang",
      "Klare Statuslogik statt Excel & Ordner",
    ],
    href: "/funktionen",
    icon: "lucide:folder-archive",
  },
  {
    id: "mod-vertraege",
    nav: "Dokumente",
    title: "Verträge & eSignatur",
    desc: "PDFs in Sekunden: strukturiert, konsistent und rechtssicher.",
    bullets: ["Kaufvertrag & Rechnung per Klick", "Standardisiert – weniger Fehler"],
    href: "/funktionen/digitale-vertraege-esignatur",
    icon: "lucide:file-signature",
  },
  {
    id: "mod-steuer",
    nav: "Steuerlogik",
    title: "§25a / EU / Export Steuerlogik",
    desc: "Autaxo erkennt den Fall und setzt Hinweise + Pflichten automatisch.",
    bullets: ["Automatische Fall-Erkennung", "Dokumentations-Hinweise im Workflow"],
    href: "/funktionen/differenzbesteuerung-25a-ustg",
    icon: "lucide:scale",
  },
  {
    id: "mod-datev",
    nav: "DATEV",
    title: "Buchhaltung & DATEV",
    desc: "Export-ready Daten, weniger Rückfragen, schnellerer Monatsabschluss.",
    bullets: ["DATEV Export per Klick", "Struktur statt Nacharbeit"],
    href: "/funktionen/buchhaltung",
    icon: "lucide:calculator",
  },
  {
    id: "mod-carlo",
    nav: "Carlo",
    title: "KI-Assistent Carlo",
    desc: "Plausibilitätschecks und Leitplanken direkt im Prozess.",
    bullets: ["Typische Fehler früh erkennen", "Hilft bei Fragen zu Steuerfällen"],
    href: "/funktionen/ki-assistent",
    icon: "lucide:bot",
  },
];

const workflowSteps = [
  {
    id: "wf-1",
    n: 1,
    title: "FIN/Scan",
    desc: "Stammdaten automatisch.",
    modalTitle: "Scannen statt Tippen.",
    modalText:
      "Ein Fahrzeug wird in unter 60 Sekunden erfasst: Fahrzeugschein scannen – Autaxo liest die FIN aus, fragt Stammdaten ab (Hersteller, Modell, EZ) und legt den Vorgang sauber an.",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(1).mp4",
    },
  },
  {
    id: "wf-2",
    n: 2,
    title: "Kauf prüfen",
    desc: "VIES/USt-IdNr.",
    modalTitle: "Kauf korrekt erfassen.",
    modalText:
      "Verkäufer werden digital erfasst. Bei EU-Geschäften wird die USt-IdNr. automatisch geprüft (VIES).",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(2).mp4",
    },
  },
  {
    id: "wf-3",
    n: 3,
    title: "Ankauf",
    desc: "Rechnung/Upload.",
    modalTitle: "Ankaufsrechnung.",
    modalText:
      "Rechtssichere Ankaufsrechnungen (Gutschrift) werden automatisch erstellt oder externe Belege werden einfach hochgeladen – alles am Vorgang.",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(3).mp4",
    },
  },
  {
    id: "wf-4",
    n: 4,
    title: "Inserat",
    desc: "Schnell online.",
    modalTitle: "Schneller inserieren.",
    modalText:
      "Verkaufsanzeigen werden mit einem Klick erstellt. Nach dem Verkauf wird das Inserat automatisch deaktiviert.",
    media: {
      type: "image",
      src: "https://storage.googleapis.com/autaxo-website/Homepage/Roadmap%20html%20block/Inserat%20Erstellen%20fu%CC%88r%20homepage%20(roadmap).png",
    },
  },
  {
    id: "wf-5",
    n: 5,
    title: "Vertrag",
    desc: "PDFs + Hinweise.",
    modalTitle: "Dokumente auf Knopfdruck.",
    modalText:
      "Kaufverträge und Rechnungen werden automatisch erzeugt. Die korrekten steuerlichen Hinweise werden je Fall ergänzt.",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(5).mp4",
    },
  },
  {
    id: "wf-6",
    n: 6,
    title: "Steuerfall",
    desc: "Auto-Erkennung.",
    modalTitle: "Steuerfälle automatisiert.",
    modalText:
      "Autaxo erkennt automatisch: Differenzbesteuerung (§25a), Regelbesteuerung, innergemeinschaftliche Lieferung oder Export. Fehler werden minimiert.",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(6).mp4",
    },
  },
  {
    id: "wf-7",
    n: 7,
    title: "Nachweise",
    desc: "Pflichten im Blick.",
    modalTitle: "Sicher für die Prüfung.",
    modalText:
      "Pflichten wie Gelangensbestätigung bei steuerfreier igL werden sichtbar gemacht und die Nachweise direkt zum Vorgang abgelegt.",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(7).mp4",
    },
  },
  {
    id: "wf-8",
    n: 8,
    title: "DATEV",
    desc: "Export per Klick.",
    modalTitle: "Für Steuerkanzlei & Monatsabschluss.",
    modalText:
      "Buchungssätze werden zum Monatsende im DATEV-Format exportiert (SKR03/04). Weniger Sortieren, weniger Rückfragen.",
    media: {
      type: "video",
      src: "https://storage.googleapis.com/autaxo-website/GIFs%20for%20Website%20(8).mp4",
    },
  },
];

// FAQ für SEO + GEO/LLM Readability (sichtbar + als FAQPage im JSON-LD)
const faqs = [
  {
    q: "Was ist §25a (Differenzbesteuerung) im Autohandel?",
    a: "§25a UStG regelt die Differenzbesteuerung für bestimmte Gebrauchtwaren (u. a. Gebrauchtfahrzeuge). Die Besteuerung bezieht sich dabei auf die Marge statt auf den gesamten Verkaufspreis (Details sind ein Steuer-/Rechts-Thema).",
  },
  {
    q: "Welche Steuerfälle deckt Autaxo ab?",
    a: "Der Fokus liegt auf Differenzbesteuerung (§25a), Regelbesteuerung, innergemeinschaftlichen Vorgängen (EU) und Export – inklusive Hinweisen und Nachweispflichten im Workflow.",
  },
  {
    q: "Wie hilft Carlo (KI) konkret?",
    a: "Carlo unterstützt mit Plausibilitätschecks im Prozess (z. B. typische Stolperfallen bei EU/Export/§25a) und liefert kontextbezogene Hinweise, bevor Fehler in Dokumente oder Buchhaltung wandern.",
  },
  {
    q: "Wie funktioniert der DATEV-Export?",
    a: "Buchungsdaten werden strukturiert im DATEV-kompatiblen Format exportiert, um Rückfragen zu reduzieren und den Monatsabschluss zu beschleunigen.",
  },
  {
    q: "Wie schnell ist ein Fahrzeug erfasst?",
    a: "Die Erfassung startet typischerweise über Scan/FIN: Stammdaten werden automatisiert übernommen, wodurch der Vorgang schneller und konsistenter angelegt wird.",
  },
  {
    q: "Für wen ist Autaxo gedacht?",
    a: "Für Autohändler, die Prozesse rund um Fahrzeugakte, Dokumente, Steuerlogik und Buchhaltung in einem System bündeln möchten – besonders relevant bei §25a, EU-Geschäften und Export.",
  },
];

/**
 * JSON-LD:
 * BaseLayout liefert bereits Organization/WebSite.
 * Hier ergänzen wir SoftwareApplication + FAQPage (ohne Organization-Doppelung).
 */
const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "SoftwareApplication",
      "@id": `${pageUrl}#app`,
      "name": "Autaxo",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web",
      "description": description,
      "url": pageUrl,
      "publisher": { "@id": `${pageUrl}#org` },
      "featureList": [
        "Digitale Fahrzeugakte",
        "Verträge & eSignatur",
        "Steuerlogik (§25a/EU/Export)",
        "DATEV-Export",
        "KI-Assistent Carlo",
      ],
    },
    {
      "@type": "FAQPage",
      "@id": `${pageUrl}#faq`,
      "mainEntity": faqs.map((f) => ({
        "@type": "Question",
        "name": f.q,
        "acceptedAnswer": { "@type": "Answer", "text": f.a },
      })),
    },
  ],
};
---

<MarketingLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  image="/og/autaxo-og.png"
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  </Fragment>

  <div class="relative overflow-hidden" data-page data-spotlight>
    <!-- Continuous background for the whole page -->
    <div class="pointer-events-none fixed inset-0 -z-10" aria-hidden="true">
      <div class="absolute inset-0 ax-mesh"></div>
      <div class="absolute inset-0 ax-grid-mask opacity-[0.55]"></div>
      <div class="absolute -top-48 -left-40 h-[640px] w-[640px] rounded-full bg-primary/18 blur-3xl ax-float"></div>
      <div class="absolute top-[55vh] -right-40 h-[720px] w-[720px] rounded-full bg-fuchsia-500/10 blur-3xl ax-float2"></div>
      <div class="absolute top-[130vh] -left-52 h-[760px] w-[760px] rounded-full bg-cyan-400/8 blur-3xl ax-float3"></div>
      <div class="absolute inset-0 ax-spotlight"></div>
    </div>

    <!-- HERO -->
    <header class="pt-28 pb-12 lg:pt-44 lg:pb-14">
      <div class="container mx-auto px-4">
        <!-- FIX: items-start statt items-center => rechter Container kann oben/unten sauber “mitlaufen” -->
        <div class="grid lg:grid-cols-12 gap-10 lg:gap-12 items-start">
          <div class="lg:col-span-6">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-white/90 text-xs font-semibold tracking-wide">
              <span class="relative flex h-2 w-2" aria-hidden="true">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
              </span>
              Live: KI-Assistent <span class="text-primary">Carlo</span>
            </div>

            <h1 id="hero-title" class="mt-6 text-5xl lg:text-7xl font-extrabold tracking-tight text-white leading-[1.02] text-balance">
              Autohandel.
              <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-red-400 to-fuchsia-400">
                {" "}Automatisiert.
              </span>
            </h1>

            <p class="mt-6 text-lg lg:text-xl text-text-muted leading-relaxed max-w-xl text-balance">
              Autaxo bündelt Fahrzeugakte, Dokumente, Steuerlogik (§25a/EU/Export) und DATEV-Export in einem durchgängigen Workflow – vom Scan bis zum Vertrag.
            </p>

            <div class="mt-8 flex flex-col sm:flex-row gap-4">
              <a
                href={signupUrl}
                class="group w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/25"
                aria-label="Autaxo kostenlos testen"
              >
                Kostenlos testen
                <Icon name="lucide:arrow-right" class="w-5 h-5 transition-transform group-hover:translate-x-0.5" aria-hidden="true" />
              </a>

              <a
                href={demoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="group w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
                aria-label="Demo-Termin im Kalender öffnen"
              >
                <Icon name="lucide:calendar" class="w-5 h-5 text-primary" aria-hidden="true" />
                Demo buchen
              </a>
            </div>

            <!-- Quick facts (LLM/GEO-friendly) -->
            <section class="mt-8" aria-label="Kurzfakten">
              <dl class="grid grid-cols-3 gap-3 max-w-lg" data-reveal>
                <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-4">
                  <dt class="text-xs text-white/60">Speed</dt>
                  <dd class="text-white text-xl font-extrabold mt-1">60s</dd>
                  <dd class="text-xs text-white/60 mt-1">FIN → Vertrag</dd>
                </div>
                <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-4">
                  <dt class="text-xs text-white/60">Steuerlogik</dt>
                  <dd class="text-white text-xl font-extrabold mt-1">§25a</dd>
                  <dd class="text-xs text-white/60 mt-1">EU & Export</dd>
                </div>
                <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-4">
                  <dt class="text-xs text-white/60">Buchhaltung</dt>
                  <dd class="text-white text-xl font-extrabold mt-1">DATEV</dd>
                  <dd class="text-xs text-white/60 mt-1">per Klick</dd>
                </div>
              </dl>
            </section>
          </div>

          <!-- Right: product window -->
          <div class="lg:col-span-6 self-stretch" data-reveal>
            <div class="relative h-full">
              <div class="absolute -inset-1 rounded-3xl bg-gradient-to-r from-primary/35 via-fuchsia-500/20 to-cyan-400/20 blur-xl opacity-70" aria-hidden="true"></div>

              <!-- FIX: h-full + flex => Container kann auf Höhe der linken Spalte wachsen -->
              <div class="relative rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl overflow-hidden shadow-2xl h-full flex flex-col">
                <div class="flex items-center justify-between px-5 py-4 border-b border-white/10 bg-white/5">
                  <div class="flex items-center gap-2" aria-hidden="true">
                    <span class="h-2.5 w-2.5 rounded-full bg-red-500/70"></span>
                    <span class="h-2.5 w-2.5 rounded-full bg-yellow-500/70"></span>
                    <span class="h-2.5 w-2.5 rounded-full bg-green-500/70"></span>
                  </div>
                  <div class="text-xs font-mono text-white/45">SSG • Edge</div>
                </div>

                <div class="p-5 lg:p-6 flex-1 flex flex-col">
                  <div class="grid sm:grid-cols-2 gap-4">
                    <div class="relative rounded-2xl border border-white/10 bg-white/5 overflow-hidden h-full">
                      <div class="absolute inset-0 ax-shine opacity-60" aria-hidden="true"></div>
                      <img
                        src="/screenshots/dark-mode.webp"
                        alt="Autaxo Dashboard mit digitaler Fahrzeugakte und Statusübersicht"
                        class="w-full h-[260px] sm:h-full object-cover object-top"
                        loading="eager"
                        decoding="async"
                        fetchpriority="high"
                      />
                      <div class="absolute bottom-3 left-3 right-3 flex items-center justify-between" aria-hidden="true">
                        <span class="text-[11px] text-white/70 bg-black/40 border border-white/10 px-2.5 py-1 rounded-full">
                          Dashboard
                        </span>
                        <span class="text-[11px] text-white/70 bg-black/40 border border-white/10 px-2.5 py-1 rounded-full">
                          Audit-ready
                        </span>
                      </div>
                    </div>

                    <!-- Carlo Card (FIX: oben zentriert + CTA Button centered) -->
                    <div class="relative rounded-2xl border border-white/10 bg-white/5 overflow-hidden h-full">
                      <div class="absolute inset-0 ax-scanline" aria-hidden="true"></div>
                      <div class="p-4 h-full flex flex-col">
                        <div class="flex flex-col items-center text-center">
                          <div class="h-10 w-10 rounded-2xl bg-primary/20 border border-primary/30 flex items-center justify-center" aria-hidden="true">
                            <Icon name="lucide:bot" class="w-5 h-5 text-primary" aria-hidden="true" />
                          </div>
                          <p class="mt-3 text-sm font-extrabold text-white leading-tight">Carlo</p>
                          <p class="mt-0.5 text-xs text-white/50">Checks im Workflow</p>
                        </div>

                        <div class="mt-4 text-sm space-y-3 flex-1">
                          <div class="rounded-2xl bg-[#15171e] border border-white/10 px-3 py-2 text-text-muted">
                            „Italien netto – welche Nachweise brauche ich?“
                          </div>
                          <div class="rounded-2xl bg-primary/10 border border-primary/20 px-3 py-2 text-white">
                            „EU/Export erkannt: VIES prüfen, Nachweise im Vorgang, Hinweise in Vertrag/Rechnung.“
                          </div>
                        </div>

                        <div class="pt-4 flex justify-center">
                          <a
                            href="/funktionen/ki-assistent"
                            class="inline-flex items-center justify-center gap-2 px-3.5 py-1.5 rounded-lg bg-primary/15 border border-primary/30 text-primary font-semibold text-xs hover:bg-primary/20 transition-colors"
                          >
                            Mehr zu Carlo
                            <Icon name="lucide:arrow-right" class="w-4 h-4" aria-hidden="true" />
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="mt-auto pt-4 flex flex-wrap gap-2" aria-label="Kernmodule">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/5 border border-white/10 text-white/70">Fahrzeugakte</span>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/5 border border-white/10 text-white/70">§25a/EU/Export</span>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-white/5 border border-white/10 text-white/70">DATEV</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- MODULE NAV + (NEU) ACCORDION -->
    <section class="pb-24" aria-labelledby="modules-title">
      <div class="container mx-auto px-4">
        <div class="grid lg:grid-cols-12 gap-10 lg:gap-12">
          <!-- Sticky Navigator -->
          <div class="lg:col-span-4">
            <div class="lg:sticky lg:top-28">
              <div class="inline-flex items-center gap-2 text-primary font-bold tracking-wider uppercase text-sm" data-reveal>
                <Icon name="lucide:layers" class="w-4 h-4" aria-hidden="true" />
                Überblick
              </div>

              <h2 id="modules-title" class="mt-3 text-3xl lg:text-4xl font-extrabold text-white text-balance" data-reveal>
                Ein System. <span class="text-primary">Ein Flow.</span>
              </h2>

              <p class="mt-4 text-text-muted" data-reveal>
                Links ein Modul auswählen – rechts klappt die Kurz-Zusammenfassung auf. Im offenen Modul führt ein Button zur passenden Funktionsseite.
              </p>

              <nav class="mt-6 grid gap-2" aria-label="Module Navigator" data-reveal>
                {modules.map((m) => (
                  <a
                    href={`#${m.id}`}
                    data-mod-link={m.id}
                    class="ax-nav-item rounded-2xl border border-white/10 bg-white/5 px-4 py-3 flex items-center gap-3 hover:border-primary/40 transition-colors"
                  >
                    <div class="h-9 w-9 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary" aria-hidden="true">
                      <Icon name={m.icon} class="w-5 h-5" aria-hidden="true" />
                    </div>
                    <div class="flex-1">
                      <p class="text-white font-bold leading-tight">{m.nav}</p>
                      <p class="text-xs text-white/50 mt-0.5">{m.title}</p>
                    </div>
                    <Icon name="lucide:chevron-right" class="w-4 h-4 text-white/40" aria-hidden="true" />
                  </a>
                ))}
              </nav>

              <div class="mt-8 flex flex-col sm:flex-row gap-3" data-reveal>
                <a
                  href={signupUrl}
                  class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-7 py-3.5 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/20"
                >
                  Kostenlos testen
                  <Icon name="lucide:arrow-right" class="w-5 h-5" aria-hidden="true" />
                </a>
                <a
                  href="/preise"
                  class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-7 py-3.5 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
                >
                  Preise
                </a>
              </div>

              <!-- FIX: “Weitere Inhalte” als sichtbare Buttons, zentriert -->
              <div class="mt-6" data-reveal>
                <p class="text-xs text-white/50 text-center mb-2">Weitere Inhalte</p>
                <div class="flex items-center justify-center gap-2">
                  <a
                    href="#workflow"
                    class="inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 hover:border-primary/40 text-white/80 hover:text-white text-xs font-semibold transition-colors"
                  >
                    <Icon name="lucide:route" class="w-4 h-4 text-primary" aria-hidden="true" />
                    Workflow
                  </a>
                  <a
                    href="#faq"
                    class="inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 hover:border-primary/40 text-white/80 hover:text-white text-xs font-semibold transition-colors"
                  >
                    <Icon name="lucide:help-circle" class="w-4 h-4 text-primary" aria-hidden="true" />
                    FAQ
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Right: Accordion Modules (eingeklappt) -->
          <div class="lg:col-span-8">
            <div class="grid gap-4">
              {modules.map((m) => (
                <details
                  id={m.id}
                  data-mod-details={m.id}
                  class="ax-accordion rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl shadow-2xl overflow-hidden"
                  data-reveal
                >
                  <summary class="ax-accordion-summary px-7 py-6 cursor-pointer">
                    <div class="flex items-start gap-4">
                      <div class="h-12 w-12 rounded-2xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary shrink-0" aria-hidden="true">
                        <Icon name={m.icon} class="w-6 h-6" aria-hidden="true" />
                      </div>

                      <div class="flex-1 min-w-0">
                        <h3 class="text-white font-extrabold text-xl">{m.title}</h3>
                        <p class="mt-1.5 text-text-muted">{m.desc}</p>
                      </div>

                      <div class="shrink-0">
                        <span class="ax-details-pill inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-xs font-semibold text-white/80">
                          <span class="ax-label-closed">Details öffnen</span>
                          <span class="ax-label-open">Details schließen</span>
                          <Icon name="lucide:chevron-down" class="ax-accordion-chevron w-4 h-4 text-primary" aria-hidden="true" />
                        </span>
                      </div>
                    </div>
                  </summary>

                  <div class="px-7 pb-7 pt-2">
                    <p class="text-xs font-bold tracking-wider uppercase text-white/50">
                      Kurz-Zusammenfassung
                    </p>

                    <ul class="mt-4 grid sm:grid-cols-2 gap-3 text-sm" aria-label={`Vorteile: ${m.title}`}>
                      {m.bullets.map((b) => (
                        <li class="flex items-start gap-2 text-white/75">
                          <Icon name="lucide:check" class="w-4 h-4 text-primary mt-0.5" aria-hidden="true" />
                          <span>{b}</span>
                        </li>
                      ))}
                    </ul>

                    <div class="mt-6 flex flex-col sm:flex-row gap-3">
                      <a
                        href={m.href}
                        class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-primary hover:bg-primary-hover text-white font-bold transition-colors shadow-xl shadow-primary/15"
                      >
                        Zur Funktionsseite
                        <Icon name="lucide:arrow-right" class="w-5 h-5" aria-hidden="true" />
                      </a>

                      <a
                        href={signupUrl}
                        class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold transition-colors"
                      >
                        Kostenlos testen
                      </a>
                    </div>
                  </div>
                </details>
              ))}
            </div>

            <div class="mt-10 ax-divider" aria-hidden="true"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORKFLOW DEMOS -->
    <section id="workflow" class="pb-24" aria-labelledby="workflow-title">
      <div class="container mx-auto px-4">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-8 lg:p-10" data-reveal>
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
            <div>
              <span class="text-primary font-bold tracking-wider uppercase text-sm block">Workflow</span>
              <h2 id="workflow-title" class="mt-2 text-3xl lg:text-4xl font-extrabold text-white text-balance">
                8 Schritte. Ein Prozess.
              </h2>
              <p class="mt-3 text-text-muted">
                Ein Klick auf eine Kachel öffnet die Demo. Videos laden erst beim Öffnen (Performance).
              </p>
            </div>

            <a
              href={signupUrl}
              class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/20"
            >
              Starten
              <Icon name="lucide:arrow-right" class="w-5 h-5" aria-hidden="true" />
            </a>
          </div>

          <div class="mt-8 grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {workflowSteps.map((s) => (
              <button
                type="button"
                data-open-modal={s.id}
                aria-controls={s.id}
                aria-haspopup="dialog"
                class="group text-left rounded-2xl border border-white/10 bg-[#0b0c10]/60 hover:border-primary/40 transition-colors p-4"
              >
                <div class="flex items-center justify-between">
                  <span class="h-8 w-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white/70 font-bold text-xs" aria-hidden="true">
                    {s.n}
                  </span>
                  <Icon name="lucide:play" class="w-4 h-4 text-white/40 group-hover:text-primary transition-colors" aria-hidden="true" />
                </div>
                <p class="mt-3 text-white font-bold">{s.title}</p>
                <p class="mt-1 text-xs text-white/60">{s.desc}</p>
              </button>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ (SEO/GEO/LLM) -->
    <section id="faq" class="pb-24" aria-labelledby="faq-title">
      <div class="container mx-auto px-4 max-w-5xl">
        <div class="rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl p-8 lg:p-10" data-reveal>
          <h2 id="faq-title" class="text-3xl lg:text-4xl font-extrabold text-white text-balance">
            FAQ: §25a, EU, Export & DATEV
          </h2>
          <p class="mt-3 text-text-muted">
            Kurze Antworten für schnelle Orientierung (keine Steuer- oder Rechtsberatung).
          </p>

          <div class="mt-8 grid gap-4">
            {faqs.map((f) => (
              <details class="rounded-2xl border border-white/10 bg-white/5 px-5 py-4">
                <summary class="cursor-pointer text-white font-semibold">
                  {f.q}
                </summary>
                <p class="mt-3 text-text-muted leading-relaxed">
                  {f.a}
                </p>
              </details>
            ))}
          </div>

          <div class="mt-8 ax-divider" aria-hidden="true"></div>

          <div class="mt-6 text-sm text-white/70">
            Mehr: <a class="underline hover:text-white" href="/funktionen">Funktionen</a> · <a class="underline hover:text-white" href="/preise">Preise</a>
          </div>
        </div>
      </div>
    </section>

    <!-- FINAL CTA -->
    <section class="pb-28">
      <div class="container mx-auto px-4 max-w-5xl">
        <div class="rounded-3xl border border-white/10 bg-[#0b0c10]/70 backdrop-blur-xl p-10 lg:p-14 text-center relative overflow-hidden" data-reveal>
          <div class="absolute -top-32 left-1/2 -translate-x-1/2 h-[420px] w-[420px] rounded-full bg-primary/20 blur-3xl" aria-hidden="true"></div>
          <h2 class="text-3xl lg:text-5xl font-extrabold text-white text-balance">
            Kostenlos testen. In wenigen Minuten einsatzbereit.
          </h2>
          <p class="mt-5 text-lg text-text-muted max-w-2xl mx-auto">
            Keine Kreditkarte erforderlich. Jederzeit kündbar.
          </p>
          <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
            <a
              href={signupUrl}
              class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl transition-all hover:-translate-y-0.5 shadow-xl shadow-primary/20"
            >
              Kostenlos starten
              <Icon name="lucide:arrow-right" class="w-5 h-5" aria-hidden="true" />
            </a>
            <a
              href={demoUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-8 py-4 bg-white/5 border border-white/10 hover:border-primary/40 text-white font-semibold rounded-xl transition-colors"
            >
              Demo buchen
            </a>
          </div>
        </div>
      </div>
    </section>

    {/* MODALS */}
    {workflowSteps.map((s) => {
      const titleId = `${s.id}-title`;
      const descId = `${s.id}-desc`;
      return (
        <dialog
          id={s.id}
          class="ax-dialog bg-transparent p-0 w-full max-w-7xl backdrop:bg-black/80 backdrop:backdrop-blur-sm rounded-2xl shadow-2xl border border-white/10 m-auto"
          aria-labelledby={titleId}
          aria-describedby={descId}
        >
          <div class="bg-[#15171e] rounded-2xl overflow-hidden relative">
            <button
              type="button"
              data-close-modal
              class="absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-primary text-white rounded-full transition-colors"
              aria-label="Dialog schließen"
            >
              <Icon name="lucide:x" class="w-6 h-6" aria-hidden="true" />
            </button>

            <div class="grid lg:grid-cols-5 h-full">
              <div class="lg:col-span-3 bg-black flex items-center justify-center aspect-video lg:aspect-auto h-[40vh] lg:h-[70vh]">
                {s.media.type === "video" ? (
                  <video
                    controls
                    preload="none"
                    playsinline
                    class="w-full h-full object-contain"
                    data-video
                    data-src={s.media.src}
                  />
                ) : (
                  <img
                    src={s.media.src}
                    alt={`Workflow Demo: ${s.title}`}
                    class="w-full h-full object-contain"
                    loading="lazy"
                    decoding="async"
                  />
                )}
              </div>

              <div class="lg:col-span-2 p-8 lg:p-12 flex flex-col justify-center bg-[#15171e]">
                <h3 id={titleId} class="text-2xl lg:text-3xl font-bold text-white mb-6">{s.modalTitle}</h3>
                <p id={descId} class="text-text-muted text-lg leading-relaxed mb-8">{s.modalText}</p>

                <button
                  type="button"
                  data-close-modal
                  class="self-start px-8 py-3 border border-white/20 hover:bg-white/10 text-white rounded-lg transition-colors"
                >
                  Schließen
                </button>
              </div>
            </div>
          </div>
        </dialog>
      );
    })}
  </div>
</MarketingLayout>

<style>
  /* Canvas background */
  .ax-mesh{
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(179,0,24,.18), transparent 55%),
      radial-gradient(900px 520px at 15% 20%, rgba(99,102,241,.18), transparent 60%),
      radial-gradient(700px 500px at 85% 70%, rgba(34,211,238,.12), transparent 60%),
      linear-gradient(180deg, rgba(11,12,16,1) 0%, rgba(11,12,16,1) 40%, rgba(11,12,16,1) 100%);
  }
  .ax-grid-mask{
    background-image:
      linear-gradient(to right, rgba(255,255,255,.07) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.07) 1px, transparent 1px);
    background-size: 48px 48px;
    mask-image: radial-gradient(70% 60% at 50% 25%, #000 0%, transparent 68%);
    -webkit-mask-image: radial-gradient(70% 60% at 50% 25%, #000 0%, transparent 68%); /* Safari fix */
  }
  .ax-spotlight{
    background: radial-gradient(650px 420px at var(--mx, 50%) var(--my, 30%), rgba(255,255,255,.10), transparent 60%);
    transition: background 80ms linear;
  }
  .ax-divider{
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
  }

  /* Scroll anchor offset (für Hash/scrollIntoView) */
  [data-mod-details] { scroll-margin-top: 120px; }

  /* Floating glows */
  @keyframes axFloat { 0%,100%{ transform:translate3d(0,0,0)} 50%{ transform:translate3d(0,-18px,0)} }
  @keyframes axFloat2 { 0%,100%{ transform:translate3d(0,0,0)} 50%{ transform:translate3d(0,14px,0)} }
  @keyframes axFloat3 { 0%,100%{ transform:translate3d(0,0,0)} 50%{ transform:translate3d(0,-10px,0)} }
  .ax-float{ animation: axFloat 9s ease-in-out infinite; }
  .ax-float2{ animation: axFloat2 11s ease-in-out infinite; }
  .ax-float3{ animation: axFloat3 12.5s ease-in-out infinite; }

  /* Shine + scanline */
  @keyframes axShine { 0%{ transform:translateX(-120%) } 100%{ transform:translateX(120%) } }
  .ax-shine{
    background: linear-gradient(110deg, transparent 0%, rgba(255,255,255,.10) 45%, transparent 60%);
    transform: translateX(-120%);
    animation: axShine 5.2s ease-in-out infinite;
  }
  @keyframes axScan { 0%{ transform:translateY(-30%)} 100%{ transform:translateY(130%)} }
  .ax-scanline{
    background: linear-gradient(180deg, transparent, rgba(179,0,24,.22), transparent);
    height: 26%;
    width: 100%;
    transform: translateY(-30%);
    animation: axScan 4.8s ease-in-out infinite;
    opacity: .35;
  }

  /* Reveal */
  .js [data-reveal]{
    opacity: 0;
    transform: translateY(14px);
    transition: opacity .6s ease, transform .7s ease;
  }
  .js [data-reveal].is-visible{
    opacity: 1;
    transform: translateY(0);
  }

  /* Nav active */
  .ax-nav-item.is-active{
    border-color: rgba(179,0,24,.55);
    background: rgba(179,0,24,.08);
  }
  .ax-nav-item.is-active p:first-child{
    color: rgba(255,255,255,1);
  }

  /* Accordion styling */
  .ax-accordion summary { list-style: none; }
  .ax-accordion summary::-webkit-details-marker { display: none; }
  .ax-accordion:focus-within { outline: 2px solid rgba(179,0,24,.35); outline-offset: 2px; }
  .ax-accordion[open]{
    border-color: rgba(179,0,24,.55);
    background: rgba(179,0,24,.06);
  }
  .ax-accordion-chevron{ transition: transform .18s ease; }
  .ax-accordion[open] .ax-accordion-chevron{ transform: rotate(180deg); }

  .ax-label-open{ display: none; }
  .ax-accordion[open] .ax-label-open{ display: inline; }
  .ax-accordion[open] .ax-label-closed{ display: none; }

  /* Dialog fallback (if showModal unsupported) */
  .ax-dialog[open] { max-height: 92vh; }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    .ax-float, .ax-float2, .ax-float3, .ax-shine, .ax-scanline{ animation: none !important; }
    .js [data-reveal]{ opacity: 1 !important; transform: none !important; }
    .ax-spotlight{ transition: none !important; }
  }
</style>

<script is:inline>
  document.documentElement.classList.add('js');

  // Spotlight (FIX: viewport-basiert => exakt unter Maus, unabhängig vom Scroll)
  const page = document.querySelector('[data-spotlight]');
  let mx = 50, my = 30, raf = 0;

  const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

  function commitSpot() {
    raf = 0;
    if (!page) return;
    page.style.setProperty('--mx', mx + '%');
    page.style.setProperty('--my', my + '%');
  }

  if (page) {
    window.addEventListener('pointermove', (ev) => {
      const w = window.innerWidth || 1;
      const h = window.innerHeight || 1;
      mx = clamp((ev.clientX / w) * 100, 0, 100);
      my = clamp((ev.clientY / h) * 100, 0, 100);
      if (!raf) raf = requestAnimationFrame(commitSpot);
    }, { passive: true });
  }

  // Reveal-on-scroll
  const revealEls = Array.from(document.querySelectorAll('[data-reveal]'));
  const io = new IntersectionObserver((entries) => {
    for (const e of entries) {
      if (e.isIntersecting) {
        e.target.classList.add('is-visible');
        io.unobserve(e.target);
      }
    }
  }, { threshold: 0.14 });
  revealEls.forEach((el) => io.observe(el));

  // Überblick: Accordion + deterministische Active-State (FIX: kein “Homepage verrückt” mehr)
  const navItems = Array.from(document.querySelectorAll('[data-mod-link]'));
  const detailsEls = Array.from(document.querySelectorAll('details[data-mod-details]'));

  function clearActive() {
    navItems.forEach((a) => {
      a.classList.remove('is-active');
      a.removeAttribute('aria-current');
    });
  }

  function setActive(id) {
    navItems.forEach((a) => {
      const isActive = a.getAttribute('data-mod-link') === id;
      a.classList.toggle('is-active', isActive);
      if (isActive) a.setAttribute('aria-current', 'true');
      else a.removeAttribute('aria-current');
    });
  }

  function closeAllExcept(id) {
    detailsEls.forEach((d) => {
      const did = d.getAttribute('data-mod-details');
      if (did !== id) d.open = false;
    });
  }

  let programmatic = false;

  function openModule(id, { scroll = true, updateHash = true } = {}) {
    const target = detailsEls.find((d) => d.getAttribute('data-mod-details') === id) || document.getElementById(id);
    if (!target) return;

    programmatic = true;
    closeAllExcept(id);
    target.open = true;
    programmatic = false;

    setActive(id);

    if (updateHash) {
      try { history.replaceState(null, '', `#${id}`); } catch (_) { /* ignore */ }
    }

    if (scroll) {
      try { target.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch (_) {}
    }
  }

  // Links-Klick: nicht “wild” springen lassen, sondern öffnen + sauber scrollen
  navItems.forEach((a) => {
    a.addEventListener('click', (e) => {
      const id = a.getAttribute('data-mod-link');
      if (!id) return;
      e.preventDefault();
      openModule(id, { scroll: true, updateHash: true });
    });
  });

  // Rechts (summary click): Akkordeon-Logik + Active + Hash
  detailsEls.forEach((d) => {
    d.addEventListener('toggle', () => {
      if (programmatic) return;
      const id = d.getAttribute('data-mod-details');
      if (!id) return;

      if (d.open) {
        programmatic = true;
        closeAllExcept(id);
        programmatic = false;

        setActive(id);
        try { history.replaceState(null, '', `#${id}`); } catch (_) {}
      } else {
        // Wenn nichts offen bleibt, Active entfernen (optional, aber sauber)
        const anyOpen = detailsEls.some((x) => x.open);
        if (!anyOpen) clearActive();
      }
    });
  });

  // Hash on load => Modul öffnen (ohne Scroll-Jump)
  try {
    const initial = decodeURIComponent(location.hash || '').replace('#', '');
    if (initial) openModule(initial, { scroll: false, updateHash: false });
  } catch (_) {}

  // Modals + lazy video attach
  const openButtons = document.querySelectorAll('[data-open-modal]');
  const closeButtons = document.querySelectorAll('[data-close-modal]');

  function attachVideoSource(dialog) {
    const video = dialog.querySelector('video[data-video]');
    if (!video) return;
    if (video.dataset.loaded === '1') return;

    const src = video.getAttribute('data-src');
    if (!src) return;

    const source = document.createElement('source');
    source.src = src;
    source.type = 'video/mp4';
    video.appendChild(source);
    video.dataset.loaded = '1';

    try { video.load(); } catch (_) {}
  }

  function playVideo(dialog) {
    const video = dialog.querySelector('video[data-video]');
    if (!video) return;
    try { video.play(); } catch (_) {}
  }

  function pauseVideo(dialog) {
    const video = dialog.querySelector('video[data-video]');
    if (!video) return;
    try { video.pause(); video.currentTime = 0; } catch (_) {}
  }

  function openModalById(id) {
    const dialog = document.getElementById(id);
    if (!dialog) return;

    attachVideoSource(dialog);

    if (typeof dialog.showModal === 'function') {
      if (!dialog.open) dialog.showModal();
    } else {
      dialog.setAttribute('open', '');
    }

    playVideo(dialog);
  }

  function closeModal(dialog) {
    if (!dialog) return;
    pauseVideo(dialog);
    if (typeof dialog.close === 'function' && dialog.open) dialog.close();
    else dialog.removeAttribute('open');
  }

  openButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-open-modal');
      if (id) openModalById(id);
    });
  });

  closeButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const dialog = btn.closest('dialog');
      closeModal(dialog);
    });
  });

  document.querySelectorAll('dialog').forEach((dialog) => {
    dialog.addEventListener('click', (e) => {
      if (e.target === dialog) closeModal(dialog);
    });

    dialog.addEventListener('cancel', (e) => {
      e.preventDefault();
      closeModal(dialog);
    });

    dialog.addEventListener('close', () => pauseVideo(dialog));
  });
</script>
