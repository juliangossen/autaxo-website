---
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("blog");

  return entries
    .map((entry) => {
      // Bevorzugt Frontmatter-Slug, sonst Dateisystem-Slug
      const raw =
        (typeof entry.data?.slug === "string" && entry.data.slug.trim())
          ? entry.data.slug.trim()
          : entry.slug;

      // Falls jemand "/blog/foo/" oder "blog/foo" eintrÃ¤gt -> letztes Segment nehmen
      const safeSlug = (raw || "")
        .split("/")
        .filter(Boolean)
        .pop();

      if (!safeSlug) return null;

      return {
        params: { slug: safeSlug },
        props: { entry },
      };
    })
    .filter(Boolean);
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---
