---
import { siteConfig } from '@/config';
import { navigation } from '@/config';
import { Icon } from 'astro-icon/components';
// ThemeToggle Import entfernt -> Seite ist jetzt "Always Dark"

const { header: headerNav } = navigation;
const mainNavItems = headerNav.main;
const ghostCTAs = headerNav.cta.filter((cta) => cta.variant === 'ghost');
const primaryCTA = headerNav.cta.find((cta) => cta.variant === 'primary');
---

<header
  id="site-header"
  class="sticky top-0 z-50 w-full border-b border-white/10 bg-[#0b0c10]/90 backdrop-blur-md"
>
  <nav class="mx-auto flex h-20 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8" aria-label="Main navigation">
    
    <div class="flex items-center gap-2">
      <a href="/" class="flex items-center gap-2 hover:opacity-80 transition-opacity" aria-label="Zur Startseite">
        <img 
          src="/logo.svg" 
          alt="Autaxo Logo" 
          class="h-10 md:h-12 w-auto min-w-[48px] object-contain text-white" 
          onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
        />
        <span class="hidden text-2xl font-bold text-white tracking-tighter">Autaxo</span>
      </a>
    </div>

    <div class="hidden md:flex items-center gap-8">
      {
        mainNavItems.map((item) => (
          item.items ? (
            /* DROPDOWN MENU */
            <div class="relative group">
              <button class="flex items-center gap-1 text-sm font-medium text-gray-300 transition-colors hover:text-white focus:outline-none group-hover:text-white py-4">
                {item.label}
                <Icon name="lucide:chevron-down" class="w-4 h-4 transition-transform group-hover:rotate-180 opacity-70" />
              </button>
              
              <div class="absolute left-0 top-full w-56 pt-2 opacity-0 invisible translate-y-2 group-hover:opacity-100 group-hover:visible group-hover:translate-y-0 transition-all duration-200 ease-out">
                <div class="bg-[#15171e] border border-white/10 rounded-lg shadow-xl p-2 flex flex-col gap-1">
                  {item.items.map((subItem) => (
                    <a
                      href={subItem.href}
                      class="block px-3 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded-md transition-colors"
                    >
                      {subItem.label}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            /* STANDARD LINK */
            <a
              href={item.href}
              class="text-sm font-medium text-gray-300 transition-colors hover:text-white"
            >
              {item.label}
            </a>
          )
        ))
      }
    </div>

    <div class="hidden md:flex items-center gap-4">
      {
        ghostCTAs.map((cta) => (
          <a
            href={cta.href}
            class="text-sm font-medium text-white hover:text-primary transition-colors"
          >
            {cta.label}
          </a>
        ))
      }

      {
        primaryCTA && (
          <a
            href={primaryCTA.href}
            class="rounded-md bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-sm hover:bg-primary-hover transition-colors"
          >
            {primaryCTA.label}
          </a>
        )
      }
    </div>

    <div class="flex items-center gap-4 md:hidden">
      <button
        id="mobile-menu-button"
        type="button"
        class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-white/5 hover:text-white focus:outline-none"
      >
        <span class="sr-only">Menü öffnen</span>
        <Icon name="lucide:menu" id="menu-icon-open" class="h-8 w-8" />
        <Icon name="lucide:x" id="menu-icon-close" class="hidden h-8 w-8" />
      </button>
    </div>
  </nav>
</header>

<div id="mobile-menu" class="fixed inset-0 z-40 hidden md:hidden" role="dialog" aria-modal="true">
  <div id="mobile-menu-backdrop" class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
  <nav id="mobile-menu-panel" class="absolute inset-x-0 top-0 z-50 h-screen overflow-y-auto border-b border-white/10 bg-[#0b0c10] p-4 shadow-lg pb-24">
    <div class="flex items-center justify-between mb-6">
        <a href="/" class="flex items-center gap-2">
            <img src="/logo.svg" alt="Autaxo" class="h-10 w-auto object-contain" />
        </a>
        <button id="mobile-menu-close-btn" class="p-2 text-gray-400 hover:text-white">
            <Icon name="lucide:x" class="h-8 w-8" />
        </button>
    </div>
    
    <div class="space-y-6">
      <div class="flex flex-col gap-1">
        {
          mainNavItems.map((item) => (
            item.items ? (
              <div class="py-2">
                <div class="px-3 py-1 text-sm font-bold text-primary uppercase tracking-wider mb-2">
                  {item.label}
                </div>
                <div class="pl-4 border-l border-white/10 ml-3 flex flex-col gap-1">
                  {item.items.map((subItem) => (
                    <a href={subItem.href} class="block px-3 py-3 text-base font-medium text-gray-400 hover:bg-white/5 hover:text-white rounded-md">
                      {subItem.label}
                    </a>
                  ))}
                </div>
              </div>
            ) : (
              <a
                href={item.href}
                class="block rounded-md px-3 py-2 text-base font-bold text-white hover:bg-white/5"
              >
                {item.label}
              </a>
            )
          ))
        }
      </div>

      <div class="border-t border-white/10 pt-6">
        <div class="grid gap-3">
          {
            ghostCTAs.map((cta) => (
              <a
                href={cta.href}
                class="flex items-center justify-center w-full px-4 py-3 rounded-lg border border-white/20 text-base font-medium text-white hover:bg-white/5 transition-colors"
              >
                {cta.label}
              </a>
            ))
          }
          {
            primaryCTA && (
              <a
                href={primaryCTA.href}
                class="flex items-center justify-center w-full px-4 py-3 rounded-lg bg-primary text-base font-bold text-white hover:bg-primary-hover transition-colors shadow-lg shadow-primary/20"
              >
                {primaryCTA.label}
              </a>
            )
          }
        </div>
      </div>
    </div>
  </nav>
</div>

<script>
  const btn = document.getElementById('mobile-menu-button');
  const closeBtn = document.getElementById('mobile-menu-close-btn');
  const menu = document.getElementById('mobile-menu');
  const backdrop = document.getElementById('mobile-menu-backdrop');

  function toggleMenu() {
    menu?.classList.toggle('hidden');
    document.body.classList.toggle('overflow-hidden');
  }

  if(btn) btn.addEventListener('click', toggleMenu);
  if(closeBtn) closeBtn.addEventListener('click', toggleMenu);
  if(backdrop) backdrop.addEventListener('click', toggleMenu);
</script>